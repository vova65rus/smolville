<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Автомобильные события</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: #1a1a1a;
      color: #f5f5f5;
      font-family: Arial, sans-serif;
    }
    .modal { display: none; }
    .modal.active { display: flex; }
  </style>
</head>
<body class="p-4">

  <!-- Логотип -->
  <div class="flex justify-center mb-6">
    <a href="https://t.me/smolville_drift" target="_blank">
      <img src="https://via.placeholder.com/180x60?text=Smolville+Drift" 
           alt="Smolville Drift" 
           class="cursor-pointer hover:opacity-80 transition">
    </a>
  </div>

  <!-- Навигация -->
  <div id="tabs" class="flex justify-center space-x-4 mb-4 hidden">
    <button id="eventsTab" class="px-4 py-2 bg-blue-600 rounded">События</button>
    <button id="adminTab" class="px-4 py-2 bg-gray-700 rounded hidden">Админ</button>
  </div>

  <!-- Контент -->
  <div id="content">
    <div id="eventsSection"></div>
    <div id="adminSection" class="hidden">
      <form id="eventForm" class="bg-gray-800 p-4 rounded mb-6">
        <input type="hidden" id="eventId">
        <input id="eventTitle" placeholder="Название" class="w-full p-2 mb-2 text-black rounded" required>
        <input id="eventDate" type="date" class="w-full p-2 mb-2 text-black rounded" required>
        <textarea id="eventDescription" placeholder="Описание" class="w-full p-2 mb-2 text-black rounded" required></textarea>
        <input id="eventImage" type="file" accept="image/*" class="mb-2">
        <div id="imagePreview" class="mb-2"></div>
        <button type="submit" class="w-full bg-green-600 p-2 rounded">Сохранить</button>
      </form>
      <div id="adminEvents"></div>
    </div>
  </div>

  <!-- Модалка события -->
  <div id="eventModal" class="modal fixed inset-0 bg-black bg-opacity-70 items-center justify-center z-50">
    <div class="bg-gray-900 p-6 rounded-lg max-w-lg w-full relative">
      <button id="closeModal" class="absolute top-2 right-2 text-white">&times;</button>
      <div id="modalContent"></div>
    </div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp || {};
    const BACKEND_URL = "https://your-backend.com"; // замени на свой
    const ADMIN_IDS = ["123456789"]; // твои TG user_id
    let currentUserId = null;

    // Получаем данные пользователя
    if (tg.initDataUnsafe?.user) {
      currentUserId = tg.initDataUnsafe.user.id.toString();
    }

    // Tabs
    const eventsTab = document.getElementById("eventsTab");
    const adminTab = document.getElementById("adminTab");
    const eventsSection = document.getElementById("eventsSection");
    const adminSection = document.getElementById("adminSection");
    const tabs = document.getElementById("tabs");

    function switchTab(tab) {
      if (tab === "events") {
        eventsSection.classList.remove("hidden");
        adminSection.classList.add("hidden");
        eventsTab.classList.add("bg-blue-600");
        adminTab.classList.remove("bg-blue-600");
      } else {
        adminSection.classList.remove("hidden");
        eventsSection.classList.add("hidden");
        adminTab.classList.add("bg-blue-600");
        eventsTab.classList.remove("bg-blue-600");
      }
    }

    eventsTab.addEventListener("click", () => switchTab("events"));
    adminTab.addEventListener("click", () => switchTab("admin"));

    // Рендер событий
    async function renderEvents() {
      eventsSection.innerHTML = "<p class='text-center'>Загрузка...</p>";
      try {
        const res = await fetch(`${BACKEND_URL}/api/events`);
        const data = await res.json();
        const events = data.records || [];
        if (!events.length) {
          eventsSection.innerHTML = "<p class='text-center'>Нет событий</p>";
          return;
        }
        events.sort((a,b)=> new Date(a.fields.Date||0)-new Date(b.fields.Date||0));
        eventsSection.innerHTML = events.map(e => `
          <div class="bg-gray-800 p-4 rounded mb-4 cursor-pointer" onclick="openEvent('${e.id}')">
            <h2 class="text-xl font-bold">${e.fields.Title}</h2>
            <p class="text-sm text-gray-400">${e.fields.Date||""}</p>
          </div>
        `).join("");
      } catch (err) {
        eventsSection.innerHTML = "<p class='text-red-500 text-center'>Ошибка загрузки</p>";
      }
    }

    // Открытие события
    async function openEvent(id) {
      try {
        const res = await fetch(`${
