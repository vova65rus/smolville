<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
  <title>Smolville</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --bg-color: #ffffff;
      --text-color: #000000;
      --hint-color: #707579;
      --link-color: #3390ec;
      --button-color: #3390ec;
      --button-text-color: #ffffff;
      --secondary-bg-color: #f4f4f5;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg-color: #1a1a1a;
        --text-color: #ffffff;
        --hint-color: #a0a0a0;
        --link-color: #4da6ff;
        --button-color: #4da6ff;
        --button-text-color: #ffffff;
        --secondary-bg-color: #2d2d2d;
      }
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s ease, color 0.3s ease;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    }

    .card {
      background: var(--secondary-bg-color);
      border-radius: 12px;
      border: 1px solid var(--hint-color);
      padding: 12px;
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .badge {
      display: inline-block;
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 9999px;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .badge-event { background: #10b981; color: white; }
    .badge-ad { background: #f59e0b; color: white; }
    .badge-vote { background: #3b82f6; color: white; }

    .modal {
      background: rgba(0, 0, 0, 0.6);
      position: fixed;
      inset: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: var(--secondary-bg-color);
      color: var(--text-color);
      padding: 20px;
      border-radius: 16px;
      max-width: 95%;
      max-height: 85%;
      overflow-y: auto;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    button {
      font-weight: 500;
    }
  </style>
</head>
<body class="min-h-screen flex flex-col">
  <div class="container mx-auto p-4 flex-grow">
    <a href="https://t.me/smolville_drift" target="_blank">
      <img src="logo.PNG" alt="Smolville Logo" class="mx-auto h-16 mb-4">
    </a>
    <h1 class="text-2xl font-bold text-center mb-6">Автособытия Сахалина</h1>

    <div id="events" class="grid grid-cols-1 gap-4">
      <!-- Пример карточки события -->
      <div class="card">
        <span class="badge badge-event">Событие</span>
        <img src="event.jpg" alt="Event" class="w-full h-40 object-cover rounded-lg mb-3">
        <h3 class="text-lg font-bold mb-1">Название события</h3>
        <p class="text-sm text-[var(--hint-color)] mb-2">Дата • Место</p>
        <button class="bg-[var(--button-color)] hover:opacity-90 text-[var(--button-text-color)] px-4 py-2 rounded-lg w-full">Подробнее</button>
      </div>

      <!-- Пример карточки рекламы -->
      <div class="card">
        <span class="badge badge-ad">Реклама</span>
        <img src="ad.jpg" alt="Ad" class="w-full h-40 object-cover rounded-lg mb-3">
        <h3 class="text-lg font-bold mb-1">Заголовок рекламы</h3>
        <p class="text-sm text-[var(--hint-color)] mb-2">Краткое описание</p>
        <button class="bg-[var(--button-color)] hover:opacity-90 text-[var(--button-text-color)] px-4 py-2 rounded-lg w-full">Перейти</button>
      </div>

      <!-- Пример карточки голосования -->
      <div class="card">
        <span class="badge badge-vote">Голосование</span>
        <img src="vote.jpg" alt="Vote" class="w-full h-40 object-cover rounded-lg mb-3">
        <h3 class="text-lg font-bold mb-1">Название голосования</h3>
        <p class="text-sm text-[var(--hint-color)] mb-2">Описание голосования</p>
        <button class="bg-[var(--button-color)] hover:opacity-90 text-[var(--button-text-color)] px-4 py-2 rounded-lg w-full">Проголосовать</button>
      </div>
    </div>

    <button id="adminBtn" class="hidden fixed bottom-4 right-4 bg-[var(--button-color)] hover:opacity-90 text-[var(--button-text-color)] px-4 py-2 rounded-full shadow-lg transition" onclick="showAdminModal()">
      ⚙️
    </button>
  </div>

  <!-- Модальные окна (событие, реклама, голосование, админка) -->
  <div id="eventModal" class="modal hidden">
    <div class="modal-content w-full md:w-[500px]">
      <h2 id="modalTitle" class="text-xl font-bold mb-2"></h2>
      <p id="modalDate" class="text-sm text-[var(--hint-color)]"></p>
      <p id="modalLocation" class="mb-2"></p>
      <p id="modalDescription" class="mb-4"></p>
      <img id="modalImage" class="w-full h-40 object-cover rounded-lg mb-4" loading="lazy">
      <div id="modalMapButtonContainer" class="hidden mb-4">
        <button id="modalMapButton" class="bg-[var(--button-color)] hover:opacity-90 text-[var(--button-text-color)] px-4 py-2 rounded-lg w-full">На карте</button>
      </div>
      <div class="flex items-center justify-between border-t pt-3">
        <span class="text-sm">Идут: <span id="attendeesCount">0</span> человек</span>
        <button id="attendButton" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition">Я пойду!</button>
      </div>
    </div>
  </div>

  <div id="adModal" class="modal hidden">
    <div class="modal-content w-full md:w-[500px]">
      <h2 id="adModalTitle" class="text-xl font-bold mb-2"></h2>
      <p id="adModalDescription" class="mb-4"></p>
      <img id="adModalImage" class="w-full h-40 object-cover rounded-lg mb-4" loading="lazy">
      <button id="adModalButton" class="bg-[var(--button-color)] hover:opacity-90 text-[var(--button-text-color)] px-4 py-2 rounded-lg w-full">Перейти</button>
    </div>
  </div>

  <div id="votingModal" class="modal hidden">
    <div class="modal-content w-full md:w-[500px]">
      <h2 id="votingModalTitle" class="text-xl font-bold mb-2"></h2>
      <p id="votingModalDescription" class="mb-4"></p>
      <div class="mb-4">
        <p class="text-sm text-[var(--hint-color)] mb-2">Для голосования необходимо находиться в радиусе 1000м от указанного места</p>
        <button id="getLocationBtn" class="bg-[var(--button-color)] hover:opacity-90 text-[var(--button-text-color)] px-4 py-2 rounded-lg w-full transition">Определить мое местоположение</button>
      </div>
      <div id="votingOptions" class="my-4"></div>
      <div id="votingResultsImageContainer" class="hidden mt-4">
        <h3 class="font-bold mb-2">Изображение с результатами:</h3>
        <img id="votingResultsImage" class="w-full rounded-lg border mb-3" loading="lazy">
        <div class="flex space-x-2">
          <button id="downloadResultsBtn" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg transition">Скачать</button>
          <button id="generateResultsBtn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg transition">Сгенерировать новое</button>
        </div>
      </div>
    </div>
  </div>

  <div id="adminModal" class="modal hidden">
    <div class="modal-content w-full md:w-[700px]">
      <h2 class="text-xl font-bold mb-4">Админ-панель</h2>
      <div class="flex mb-4 overflow-x-auto space-x-2">
        <div class="tab active bg-[var(--button-color)] text-[var(--button-text-color)] px-4 py-2 rounded-lg cursor-pointer" onclick="showTab('tab-list')">События</div>
        <div class="tab bg-[var(--secondary-bg-color)] text-[var(--text-color)] px-4 py-2 rounded-lg cursor-pointer" onclick="showTab('tab-form')">Добавить событие</div>
        <div class="tab bg-[var(--secondary-bg-color)] text-[var(--text-color)] px-4 py-2 rounded-lg cursor-pointer" onclick="showTab('tab-ads-list')">Реклама</div>
        <div class="tab bg-[var(--secondary-bg-color)] text-[var(--text-color)] px-4 py-2 rounded-lg cursor-pointer" onclick="showTab('tab-ad-form')">Добавить рекламу</div>
        <div class="tab bg-[var(--secondary-bg-color)] text-[var(--text-color)] px-4 py-2 rounded-lg cursor-pointer" onclick="showTab('tab-votings-list')">Голосования</div>
        <div class="tab bg-[var(--secondary-bg-color)] text-[var(--text-color)] px-4 py-2 rounded-lg cursor-pointer" onclick="showTab('tab-voting-form')">Добавить голосование</div>
      </div>
      <div id="tab-list" class="tab-content active">
        <h3 class="text-md font-bold mb-2">Список событий</h3>
        <div id="eventList"></div>
      </div>
      <div id="tab-form" class="tab-content hidden">
        <h3 class="text-md font-bold mb-2">Добавить/Редактировать событие</h3>
        <form id="eventForm" class="space-y-2">
          <input type="hidden" id="eventRecordId">
          <input type="text" id="eventTitle" placeholder="Название" class="border p-2 w-full rounded" required>
          <input type="date" id="eventDate" class="border p-2 w-full rounded" required>
          <input type="text" id="eventLocation" placeholder="Место" class="border p-2 w-full rounded" required>
          <textarea id="eventDescription" placeholder="Описание" class="border p-2 w-full rounded"></textarea>
          <button type="submit" class="bg-[var(--button-color)] hover:opacity-90 text-[var(--button-text-color)] px-4 py-2 rounded-lg w-full">Сохранить</button>
        </form>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
