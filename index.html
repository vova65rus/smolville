<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini App: –ê—Ñ–∏—à–∞ –∏ –ú–∞–≥–∞–∑–∏–Ω</title>
<style>
  body { font-family: Arial; background: #f5f5f5; margin:0; padding:15px; }
  h2 { text-align:center; margin-bottom:20px; }
  .section { margin-bottom:30px; }
  .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
  .card { background:#fff; border-radius:10px; padding:15px; box-shadow:0 2px 5px rgba(0,0,0,0.1); position:relative; }
  .card img { width:100%; border-radius:8px; margin-bottom:10px; }
  .card h3 { margin:5px 0; font-size:1.1rem; }
  .card p { margin:3px 0; color:#666; font-size:0.9rem; }
  .btn { padding:8px 12px; margin:5px 5px 0 0; border:none; border-radius:6px; color:#fff; cursor:pointer; font-size:0.9rem; }
  .btn-go { background:#e63946; }
  .btn-map { background:#457b9d; }
  .btn-cart { background:#2a9d8f; }
  .status { position:absolute; top:10px; right:10px; background:#2a9d8f; color:#fff; padding:5px 8px; border-radius:5px; font-size:0.8rem; display:none; }
  .status.active { display:block; }
</style>
</head>
<body>

<h2>üöó –ê—Ñ–∏—à–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π</h2>
<div class="section">
  <input type="text" id="searchEvents" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." style="width:100%; padding:8px; margin-bottom:10px;">
  <div class="grid" id="events"></div>
</div>

<h2>üõç –ú–∞–≥–∞–∑–∏–Ω –º–µ—Ä—á–∞</h2>
<div class="section">
  <input type="text" id="searchShop" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Ç–æ–≤–∞—Ä—É..." style="width:100%; padding:8px; margin-bottom:10px;">
  <div class="grid" id="shop"></div>
</div>

<h2>üë§ –ú–æ–π –∫–∞–±–∏–Ω–µ—Ç</h2>
<div class="section">
  <h3>–û—Ç–º–µ—á–µ–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h3>
  <ul id="myEvents"></ul>
  <h3>–ö–æ—Ä–∑–∏–Ω–∞</h3>
  <ul id="myCart"></ul>
</div>

<script>
  // Telegram WebApp
  let tg=null;
  try { if(window.Telegram && window.Telegram.WebApp){ tg=window.Telegram.WebApp; tg.expand(); } } catch(e){ console.log("–ë–µ–∑ Telegram"); }

  // –î–∞–Ω–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
  const eventsData=[
    {title:"Drift Weekend", date:"12 —Å–µ–Ω—Ç—è–±—Ä—è", place:"–Æ–∂–Ω–æ-–°–∞—Ö–∞–ª–∏–Ω—Å–∫", coords:"46.9591,142.7386", image:"https://picsum.photos/400/200?random=1"},
    {title:"AutoFest Show", date:"20 —Å–µ–Ω—Ç—è–±—Ä—è", place:"–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫", coords:"43.1155,131.8855", image:"https://picsum.photos/400/200?random=2"},
    {title:"Street Racing Meet", date:"28 —Å–µ–Ω—Ç—è–±—Ä—è", place:"–•–∞–±–∞—Ä–æ–≤—Å–∫", coords:"48.4820,135.0711", image:"https://picsum.photos/400/200?random=3"}
  ];

  // –î–∞–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω–∞
  const shopData=[
    {name:"–§—É—Ç–±–æ–ª–∫–∞ Drift", price:"1500‚ÇΩ", image:"https://picsum.photos/200/200?random=10"},
    {name:"–ö–µ–ø–∫–∞ AutoFest", price:"800‚ÇΩ", image:"https://picsum.photos/200/200?random=11"},
    {name:"–ù–∞–∫–ª–µ–π–∫–∞ Street Racing", price:"200‚ÇΩ", image:"https://picsum.photos/200/200?random=12"}
  ];

  // LocalStorage
  let eventStatus=JSON.parse(localStorage.getItem("goingStatus"))||{};
  let cart=JSON.parse(localStorage.getItem("cart"))||[];

  const eventsContainer=document.getElementById("events");
  const shopContainer=document.getElementById("shop");
  const myEventsList=document.getElementById("myEvents");
  const myCartList=document.getElementById("myCart");

  // –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∞ –∞—Ñ–∏—à–∏
  function renderEvents(filter=""){
    eventsContainer.innerHTML="";
    eventsData.forEach((ev,i)=>{
      if(!ev.title.toLowerCase().includes(filter.toLowerCase())) return;
      const card=document.createElement("div");
      card.className="card";
      card.innerHTML=`
        <div class="status ${eventStatus[i]?"active":""}">–û—Ç–º–µ—á–µ–Ω–æ ‚úÖ</div>
        <img src="${ev.image}" alt="${ev.title}">
        <h3>${ev.title}</h3>
        <p>üìÖ ${ev.date}</p>
        <p>üìç ${ev.place}</p>
        <button class="btn btn-go">–•–æ—á—É –ø–æ–π—Ç–∏</button>
        <button class="btn btn-map">–û—Ç–∫—Ä—ã—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ</button>
      `;
      const btnGo=card.querySelector(".btn-go");
      const btnMap=card.querySelector(".btn-map");
      const statusEl=card.querySelector(".status");

      btnGo.addEventListener("click",()=>{
        statusEl.classList.add("active");
        eventStatus[i]=true;
        localStorage.setItem("goingStatus", JSON.stringify(eventStatus));
        updateMyEvents();
      });
      btnMap.addEventListener("click",()=>window.open(`https://www.google.com/maps/search/?api=1&query=${ev.coords}`,"_blank"));
      eventsContainer.appendChild(card);
    });
  }

  // –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∞ –º–∞–≥–∞–∑–∏–Ω–∞
  function renderShop(filter=""){
    shopContainer.innerHTML="";
    shopData.forEach((item,i)=>{
      if(!item.name.toLowerCase().includes(filter.toLowerCase())) return;
      const card=document.createElement("div");
      card.className="card";
      card.innerHTML=`
        <img src="${item.image}" alt="${item.name}">
        <h3>${item.name}</h3>
        <p>üí∞ ${item.price}</p>
        <button class="btn btn-cart">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
      `;
      const btnCart=card.querySelector(".btn-cart");
      btnCart.addEventListener("click",()=>{
        cart.push(item);
        localStorage.setItem("cart", JSON.stringify(cart));
        updateMyCart();
      });
      shopContainer.appendChild(card);
    });
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞
  function updateMyEvents(){
    myEventsList.innerHTML="";
    eventsData.forEach((ev,i)=>{
      if(eventStatus[i]){
        const li=document.createElement("li");
        li.textContent=ev.title+" ("+ev.date+")";
        myEventsList.appendChild(li);
      }
    });
  }

  function updateMyCart(){
    myCartList.innerHTML="";
    cart.forEach(item=>{
      const li=document.createElement("li");
      li.textContent=item.name+" - "+item.price;
      myCartList.appendChild(li);
    });
  }

  // –ü–æ–∏—Å–∫
  document.getElementById("searchEvents").addEventListener("input",(e)=>renderEvents(e.target.value));
  document.getElementById("searchShop").addEventListener("input",(e)=>renderShop(e.target.value));

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  renderEvents();
  renderShop();
  updateMyEvents();
  updateMyCart();
</script>
</body>
</html>
